<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Форум по Ванильному Minecraft</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="%23ffffff" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 1s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(255,215,0,0.5); }
            to { text-shadow: 2px 2px 4px rgba(255,0,0,0.5); }
        }
        .question-form {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
            transition: transform 0.3s;
        }
        .question-form:hover {
            transform: translateY(-5px);
        }
        .question-form h2 {
            color: #ffd700;
            margin-top: 0;
            font-weight: 700;
        }
        .question-form input, .question-form textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
            font-family: 'Roboto', sans-serif;
            transition: border-color 0.3s;
        }
        .question-form input:focus, .question-form textarea:focus {
            border-color: #ff6b6b;
            outline: none;
        }
        .question-form button {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.3s;
        }
        .question-form button:hover {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
        }
        .questions-list {
            margin-top: 30px;
        }
        .question {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
            transition: transform 0.3s;
        }
        .question:hover {
            transform: translateY(-3px);
        }
        .question h3 {
            color: #ffd700;
            margin-top: 0;
            font-weight: 700;
        }
        .question p {
            margin-bottom: 10px;
        }
        .answer-form {
            margin-top: 15px;
            display: none; /* Hidden by default, shown only for admins */
        }
        .answer-form textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
            font-family: 'Roboto', sans-serif;
            transition: border-color 0.3s;
        }
        .answer-form textarea:focus {
            border-color: #ff6b6b;
            outline: none;
        }
        .answer-form button {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.3s;
        }
        .answer-form button:hover {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
        }
        .answers {
            margin-top: 20px;
            padding-left: 20px;
            border-left: 3px solid #ffd700;
        }
        .answer {
            background: rgba(42, 42, 42, 0.8);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 1px solid #ff6b6b;
        }
        .admin-login {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
        }
        .admin-login h2 {
            color: #ffd700;
            margin-top: 0;
        }
        .admin-login input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
        }
        .admin-login button {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
        }
        .admin-login button:hover {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }
        .moderation-btns {
            margin-top: 10px;
        }
        .moderation-btns button {
            background: #ff6b6b;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 0.8em;
        }
        .moderation-btns button:hover {
            background: #cc5555;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .tab-btn {
            background: rgba(26, 26, 26, 0.9);
            color: #ffd700;
            border: 2px solid #ffd700;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.3s;
        }
        .tab-btn.active {
            background: #ffd700;
            color: #000;
        }
        .tab-btn:hover {
            background: rgba(255,215,0,0.2);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .user-auth {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
        }
        .user-auth h2 {
            color: #ffd700;
            margin-top: 0;
        }
        .user-auth input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
        }
        .user-auth button {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            margin-right: 10px;
        }
        .user-auth button:hover {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
        }
        .complaint-form {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
            transition: transform 0.3s;
        }
        .complaint-form:hover {
            transform: translateY(-5px);
        }
        .complaint-form h2 {
            color: #ffd700;
            margin-top: 0;
            font-weight: 700;
        }
        .complaint-form input, .complaint-form textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
            font-family: 'Roboto', sans-serif;
            transition: border-color 0.3s;
        }
        .complaint-form input:focus, .complaint-form textarea:focus {
            border-color: #ff6b6b;
            outline: none;
        }
        .complaint-form input[type="file"] {
            margin-bottom: 10px;
        }
        .complaint-form button {
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.3s;
        }
        .complaint-form button:hover {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
        }
        .complaint {
            background: rgba(26, 26, 26, 0.9);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            box-shadow: 0 4px 8px rgba(255,215,0,0.3);
        }
        .complaint h3 {
            color: #ffd700;
            margin-top: 0;
        }
        .complaint img, .complaint video {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        .user-logout-btn {
            position: absolute;
            top: 20px;
            right: 100px;
            background: #ff6b6b;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-cube"></i> Форум по Ванильному Minecraft <i class="fas fa-cube"></i></h1>

        <div class="admin-login" id="adminLogin">
            <h2><i class="fas fa-user-shield"></i> Вход для администратора</h2>
            <input type="text" id="adminUsername" placeholder="Логин" required>
            <input type="password" id="adminPassword" placeholder="Пароль" required>
            <button onclick="adminLogin()">Войти</button>
        </div>

        <button class="logout-btn" id="logoutBtn" style="display: none;" onclick="adminLogout()">Выйти</button>

        <div class="user-auth" id="userAuth">
            <h2><i class="fas fa-user"></i> Регистрация / Вход</h2>
            <input type="text" id="userUsername" placeholder="Логин" required>
            <input type="password" id="userPassword" placeholder="Пароль" required>
            <button onclick="userRegister()">Регистрация</button>
            <button onclick="userLogin()">Войти</button>
        </div>

        <button class="user-logout-btn" id="userLogoutBtn" style="display: none;" onclick="userLogout()">Выйти (Пользователь)</button>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('questions')">Вопросы</button>
            <button class="tab-btn" onclick="switchTab('complaints')">Жалобы</button>
        </div>

        <div id="questionsTab" class="tab-content active">
            <div class="question-form">
                <h2><i class="fas fa-question-circle"></i> Задать вопрос</h2>
                <form id="questionForm">
                    <input type="text" id="questionTitle" placeholder="Заголовок вопроса" required>
                    <textarea id="questionText" placeholder="Подробное описание вопроса" rows="4" required></textarea>
                    <button type="submit"><i class="fas fa-paper-plane"></i> Отправить вопрос</button>
                </form>
            </div>

            <div class="questions-list" id="questionsList">
                <!-- Вопросы будут добавляться сюда -->
            </div>
        </div>

        <div id="complaintsTab" class="tab-content">
            <div class="complaint-form">
                <h2><i class="fas fa-exclamation-triangle"></i> Подать жалобу</h2>
                <form id="complaintForm">
                    <input type="text" id="complaintTitle" placeholder="Заголовок жалобы" required>
                    <textarea id="complaintText" placeholder="Описание жалобы" rows="4" required></textarea>
                    <input type="file" id="complaintFile" accept="image/*,video/*" multiple>
                    <button type="submit"><i class="fas fa-paper-plane"></i> Отправить жалобу</button>
                </form>
            </div>

            <div class="complaints-list" id="complaintsList">
                <!-- Жалобы будут добавляться сюда -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const questionForm = document.getElementById('questionForm');
            const questionsList = document.getElementById('questionsList');
            const complaintForm = document.getElementById('complaintForm');
            const complaintsList = document.getElementById('complaintsList');
            const adminLogin = document.getElementById('adminLogin');
            const logoutBtn = document.getElementById('logoutBtn');
            const userAuth = document.getElementById('userAuth');
            const userLogoutBtn = document.getElementById('userLogoutBtn');

            // Инициализация админов и пользователей
            initializeAdmins();
            initializeUsers();

            // Проверка статуса при загрузке
            checkAdminStatus();
            checkUserStatus();

            // Загрузка данных из localStorage
            loadQuestions();
            loadComplaints();

            // Обработчик формы вопросов
            questionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('questionTitle').value;
                const text = document.getElementById('questionText').value;
                const user = isUserLoggedIn() ? JSON.parse(localStorage.getItem('currentUser')).username : 'Аноним';

                const question = {
                    id: Date.now(),
                    title: title,
                    text: text,
                    user: user,
                    answers: [],
                    timestamp: new Date().toLocaleString()
                };

                saveQuestion(question);
                displayQuestion(question);

                questionForm.reset();
            });

            // Обработчик формы жалоб
            complaintForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('complaintTitle').value;
                const text = document.getElementById('complaintText').value;
                const fileInput = document.getElementById('complaintFile');
                const user = isUserLoggedIn() ? JSON.parse(localStorage.getItem('currentUser')).username : 'Аноним';

                const complaint = {
                    id: Date.now(),
                    title: title,
                    text: text,
                    user: user,
                    files: [],
                    timestamp: new Date().toLocaleString()
                };

                // Обработка файлов
                if (fileInput.files.length > 0) {
                    Array.from(fileInput.files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            complaint.files.push({
                                name: file.name,
                                type: file.type,
                                data: e.target.result
                            });
                            if (complaint.files.length === fileInput.files.length) {
                                saveComplaint(complaint);
                                displayComplaint(complaint);
                                complaintForm.reset();
                            }
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    saveComplaint(complaint);
                    displayComplaint(complaint);
                    complaintForm.reset();
                }
            });

            function saveQuestion(question) {
                const questions = JSON.parse(localStorage.getItem('minecraftQuestions') || '[]');
                questions.push(question);
                localStorage.setItem('minecraftQuestions', JSON.stringify(questions));
            }

            function loadQuestions() {
                const questions = JSON.parse(localStorage.getItem('minecraftQuestions') || '[]');
                questions.forEach(displayQuestion);
            }

            function displayQuestion(question) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <h3><i class="fas fa-question"></i> ${question.title}</h3>
                    <p>${question.text}</p>
                    <small><i class="fas fa-user"></i> Пользователь: ${question.user} | <i class="fas fa-clock"></i> Задан: ${question.timestamp}</small>
                    <div class="moderation-btns" style="display: none;">
                        <button onclick="editQuestion(${question.id})"><i class="fas fa-edit"></i> Редактировать</button>
                        <button onclick="deleteQuestion(${question.id})"><i class="fas fa-trash"></i> Удалить</button>
                    </div>
                    <div class="answer-form">
                        <textarea placeholder="Ваш ответ" rows="3"></textarea>
                        <button onclick="addAnswer(${question.id}, this.previousElementSibling.value)"><i class="fas fa-reply"></i> Ответить</button>
                    </div>
                    <div class="answers" id="answers-${question.id}">
                        ${question.answers.map(answer => `<div class="answer"><p>${answer.text}</p><small><i class="fas fa-user"></i> ${answer.timestamp}</small></div>`).join('')}
                    </div>
                `;
                questionsList.appendChild(questionDiv);
                // Показать форму ответа и кнопки модерации только админам
                if (localStorage.getItem('adminLoggedIn') === 'true') {
                    questionDiv.querySelector('.answer-form').style.display = 'block';
                    questionDiv.querySelector('.moderation-btns').style.display = 'block';
                }
            }

            function saveComplaint(complaint) {
                const complaints = JSON.parse(localStorage.getItem('minecraftComplaints') || '[]');
                complaints.push(complaint);
                localStorage.setItem('minecraftComplaints', JSON.stringify(complaints));
            }

            function loadComplaints() {
                const complaints = JSON.parse(localStorage.getItem('minecraftComplaints') || '[]');
                complaints.forEach(displayComplaint);
            }

            function displayComplaint(complaint) {
                const complaintDiv = document.createElement('div');
                complaintDiv.className = 'complaint';
                let filesHtml = '';
                if (complaint.files && complaint.files.length > 0) {
                    filesHtml = complaint.files.map(file => {
                        if (file.type.startsWith('image/')) {
                            return `<img src="${file.data}" alt="${file.name}">`;
                        } else if (file.type.startsWith('video/')) {
                            return `<video controls><source src="${file.data}" type="${file.type}"></video>`;
                        }
                        return '';
                    }).join('');
                }
                complaintDiv.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> ${complaint.title}</h3>
                    <p>${complaint.text}</p>
                    <small><i class="fas fa-user"></i> Пользователь: ${complaint.user} | <i class="fas fa-clock"></i> Подана: ${complaint.timestamp}</small>
                    ${filesHtml}
                `;
                complaintsList.appendChild(complaintDiv);
            }

            window.addAnswer = function(questionId, answerText) {
                if (!answerText.trim()) return;
                if (localStorage.getItem('adminLoggedIn') !== 'true') {
                    alert('Только администраторы могут отвечать на вопросы!');
                    return;
                }

                const questions = JSON.parse(localStorage.getItem('minecraftQuestions') || '[]');
                const question = questions.find(q => q.id === questionId);
                if (question) {
                    const answer = {
                        text: answerText,
                        timestamp: new Date().toLocaleString()
                    };
                    question.answers.push(answer);
                    localStorage.setItem('minecraftQuestions', JSON.stringify(questions));

                    // Обновить отображение
                    const answersDiv = document.getElementById(`answers-${questionId}`);
                    answersDiv.innerHTML += `<div class="answer"><p>${answer.text}</p><small><i class="fas fa-user"></i> ${answer.timestamp}</small></div>`;

                    // Очистить textarea
                    event.target.previousElementSibling.value = '';
                }
            };

            function initializeAdmins() {
                if (!localStorage.getItem('admins')) {
                    const admins = [
                        { username: 'admin', password: 'admin' },
                        { username: 'TB1KCTEP', password: '2886503480N' }
                    ];
                    localStorage.setItem('admins', JSON.stringify(admins));
                }
            }

            function initializeUsers() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
            }

            function isUserLoggedIn() {
                return localStorage.getItem('currentUser') !== null;
            }

            window.userRegister = function() {
                const username = document.getElementById('userUsername').value;
                const password = document.getElementById('userPassword').value;
                if (!username || !password) {
                    alert('Заполните все поля!');
                    return;
                }
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                if (users.find(u => u.username === username)) {
                    alert('Пользователь с таким логином уже существует!');
                    return;
                }
                users.push({ username, password });
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify({ username }));
                checkUserStatus();
                alert('Регистрация успешна!');
            };

            window.userLogin = function() {
                const username = document.getElementById('userUsername').value;
                const password = document.getElementById('userPassword').value;
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    localStorage.setItem('currentUser', JSON.stringify({ username }));
                    checkUserStatus();
                    alert('Вход выполнен успешно!');
                } else {
                    alert('Неверный логин или пароль!');
                }
            };

            window.userLogout = function() {
                localStorage.removeItem('currentUser');
                checkUserStatus();
                alert('Вы вышли из системы.');
            };

            window.switchTab = function(tab) {
                const tabs = document.querySelectorAll('.tab-btn');
                const contents = document.querySelectorAll('.tab-content');
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                if (tab === 'questions') {
                    document.querySelector('button[onclick="switchTab(\'questions\')"]').classList.add('active');
                    document.getElementById('questionsTab').classList.add('active');
                } else if (tab === 'complaints') {
                    document.querySelector('button[onclick="switchTab(\'complaints\')"]').classList.add('active');
                    document.getElementById('complaintsTab').classList.add('active');
                }
            };

            window.adminLogin = function() {
                const username = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                const admins = JSON.parse(localStorage.getItem('admins') || '[]');
                const admin = admins.find(a => a.username === username && a.password === password);
                if (admin) {
                    localStorage.setItem('adminLoggedIn', 'true');
                    checkAdminStatus();
                    alert('Вход выполнен успешно!');
                } else {
                    alert('Неверный логин или пароль!');
                }
            };

            window.adminLogout = function() {
                localStorage.removeItem('adminLoggedIn');
                checkAdminStatus();
                alert('Вы вышли из системы.');
            };

            window.editQuestion = function(questionId) {
                const questions = JSON.parse(localStorage.getItem('minecraftQuestions') || '[]');
                const question = questions.find(q => q.id === questionId);
                if (question) {
                    const newTitle = prompt('Новый заголовок:', question.title);
                    const newText = prompt('Новый текст вопроса:', question.text);
                    if (newTitle && newText) {
                        question.title = newTitle;
                        question.text = newText;
                        localStorage.setItem('minecraftQuestions', JSON.stringify(questions));
                        // Перезагрузить вопросы
                        questionsList.innerHTML = '';
                        loadQuestions();
                    }
                }
            };

            window.deleteQuestion = function(questionId) {
                if (confirm('Вы уверены, что хотите удалить этот вопрос?')) {
                    const questions = JSON.parse(localStorage.getItem('minecraftQuestions') || '[]');
                    const updatedQuestions = questions.filter(q => q.id !== questionId);
                    localStorage.setItem('minecraftQuestions', JSON.stringify(updatedQuestions));
                    // Перезагрузить вопросы
                    questionsList.innerHTML = '';
                    loadQuestions();
                }
            };

            function checkAdminStatus() {
                if (localStorage.getItem('adminLoggedIn') === 'true') {
                    adminLogin.style.display = 'none';
                    logoutBtn.style.display = 'block';
                    // Показать все формы ответа и кнопки модерации
                    document.querySelectorAll('.answer-form').forEach(form => form.style.display = 'block');
                    document.querySelectorAll('.moderation-btns').forEach(btns => btns.style.display = 'block');
                } else {
                    adminLogin.style.display = 'block';
                    logoutBtn.style.display = 'none';
                    // Скрыть все формы ответа и кнопки модерации
                    document.querySelectorAll('.answer-form').forEach(form => form.style.display = 'none');
                    document.querySelectorAll('.moderation-btns').forEach(btns => btns.style.display = 'none');
                }
            }

            function checkUserStatus() {
                if (isUserLoggedIn()) {
                    userAuth.style.display = 'none';
                    userLogoutBtn.style.display = 'block';
                } else {
                    userAuth.style.display = 'block';
                    userLogoutBtn.style.display = 'none';
                }
                // Формы вопросов и жалоб всегда видны
                document.querySelector('.question-form').style.display = 'block';
                document.querySelector('.complaint-form').style.display = 'block';
            }
        });
    </script>
</body>
</html>
